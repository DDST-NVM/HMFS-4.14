diff --git a/fs/hmfs/Makefile b/fs/hmfs/Makefile
deleted file mode 100644
index 0f9932d..0000000
--- a/fs/hmfs/Makefile
+++ /dev/null
@@ -1,9 +0,0 @@
-ccflags-y	:= -O0
-obj-$(CONFIG_HMFS_FS) += hmfs.o
-
-hmfs-y := super.o node.o inode.o checkpoint.o file.o data.o namei.o segment.o hash.o dir.o symlink.o gc.o recovery.o vmap.o initfs.o util.o proc.o
-
-hmfs-$(CONFIG_HMFS_DEBUG) += debug.o
-hmfs-$(CONFIG_HMFS_XATTR) += xattr.o
-hmfs-$(CONFIG_HMFS_ACL) += acl.o
-
diff --git a/fs/hmfs/Makefile b/fs/hmfs/Makefile
new file mode 120000
index 0000000..7e36b06
--- /dev/null
+++ b/fs/hmfs/Makefile
@@ -0,0 +1 @@
+Makefile.kernel
\ No newline at end of file
diff --git a/fs/hmfs/Makefile.goku b/fs/hmfs/Makefile.goku
old mode 100644
new mode 100755
diff --git a/fs/hmfs/Makefile.kernel b/fs/hmfs/Makefile.kernel
old mode 100644
new mode 100755
diff --git a/fs/hmfs/inode.c b/fs/hmfs/inode.c
index e2e5b7c..4c8d9c3 100644
--- a/fs/hmfs/inode.c
+++ b/fs/hmfs/inode.c
@@ -248,7 +248,7 @@ struct inode *hmfs_iget(struct super_block *sb, unsigned long ino)
 	ret = do_read_inode(inode);
 	if (ret)
 		goto bad_inode;
-	inode->i_mapping->backing_dev_info = &hmfs_backing_dev_info;
+//	inode->i_mapping->backing_dev_info = &hmfs_backing_dev_info;
 
 	switch (inode->i_mode & S_IFMT) {
 	case S_IFREG:
@@ -276,6 +276,6 @@ struct inode *hmfs_iget(struct super_block *sb, unsigned long ino)
 
 //TODO
 const struct address_space_operations hmfs_aops_xip = {
-	.get_xip_mem = NULL,
+//	.get_xip_mem = NULL,
 	.direct_IO = NULL,
 };
diff --git a/fs/hmfs/segment.h b/fs/hmfs/segment.h
index cc69d2a..5942dd4 100644
--- a/fs/hmfs/segment.h
+++ b/fs/hmfs/segment.h
@@ -2,6 +2,7 @@
 #define HMFS_SEGMENT_H
 
 #include "hmfs.h"
+#include <linux/time.h>
 
 #define SIT_ENTRY_CLEAN			0
 #define SIT_ENTRY_DIRTY				1
@@ -283,8 +284,8 @@ static inline bool has_not_enough_free_segs(struct hmfs_sb_info *sbi)
 static inline unsigned long long get_mtime(struct hmfs_sb_info *sbi)
 {
 	struct sit_info *sit_i = SIT_I(sbi);
-
-	return sit_i->elapsed_time + CURRENT_TIME_SEC.tv_sec -
+    struct timeval ct;
+	return sit_i->elapsed_time + ct.tv_sec -
 	 sit_i->mounted_time;
 }
 
diff --git a/fs/hmfs/super.c b/fs/hmfs/super.c
index e0ce8d1..4fa0b27 100644
--- a/fs/hmfs/super.c
+++ b/fs/hmfs/super.c
@@ -14,7 +14,7 @@
 #include "node.h"
 #include "util.h"
 
-static struct kmem_cache *hmfs_inode_cachep_;	//inode cachep
+static struct kmem_cache *hmfs_inode_cachep;	//inode cachep
 
 static void init_once(void *foo)
 {
